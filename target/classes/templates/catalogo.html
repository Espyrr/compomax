<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="fragmentos/header :: head">
    <title>Catálogo - Compomax</title>
</head>
<body>

<!-- Navbar -->
<div th:replace="fragmentos/navbar :: nav"></div>

<div class="container mt-4">
    <h2 class="mb-4">Catálogo de Productos</h2>

    <!-- Filtros -->
    <form th:action="@{/catalogo}" method="get" class="row mb-4">
        <div class="col-md-3">
            <select name="categoria" class="form-select">
                <option th:value="" th:selected="${categoria == null}">Todas las categorías</option>
                <option th:each="cat : ${lstCategorias}" th:value="${cat.idCategoria}"
                        th:text="${cat.descripcion}"
                        th:selected="${cat.idCategoria == categoria}">
                </option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="tipoOrden" class="form-select">
                <option th:value="" th:selected="${tipoOrden == null}">Ordenar por</option>
                <option value="precioAsc" th:selected="${tipoOrden == 'precioAsc'}">Precio: Menor a Mayor</option>
                <option value="precioDesc" th:selected="${tipoOrden == 'precioDesc'}">Precio: Mayor a Menor</option>
            </select>
        </div>
        <div class="col-md-4">
            <div class="input-group">
                <input type="text" name="buscar" class="form-control" placeholder="Buscar producto..."
                       th:value="${buscar}">
                <button class="btn btn-primary" type="submit">Buscar</button>
            </div>
        </div>
    </form>

    <!-- Productos -->
    <div class="row">
        <div class="col-md-3 mb-4" th:each="prod : ${lstProductos}">
            <div class="card h-100">
                <img th:src="@{'/img/productos/' + ${prod.idProducto} + '.jpg'}" class="card-img-top" alt="Imagen del producto">
                <div class="card-body">
                    <h5 class="card-title" th:text="${prod.descripcion}"></h5>
                    <p class="card-text">
                        <strong>Precio:</strong> S/ <span th:text="${#numbers.formatDecimal(prod.precio, 1, 'POINT', 2, 'POINT')}"></span><br>
                        <strong>Stock:</strong> <span th:text="${prod.stock}"></span><br>
                        <strong>Categoría:</strong> <span th:text="${prod.idCategoria.descripcion}"></span>
                    </p>
                    <a th:href="@{'/producto/' + ${prod.idProducto}}" class="btn btn-outline-primary w-100">Ver más</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Paginación -->
    <nav th:if="${totalPaginas > 1}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPaginas)}"
                th:classappend="${i == paginaActual} ? 'active'">
                <a class="page-link" th:href="@{/catalogo(pagina=${i}, tipoOrden=${tipoOrden}, buscar=${buscar}, categoria=${categoria})}" th:text="${i}"></a>
            </li>
        </ul>
    </nav>
</div>

<!-- Footer -->
<footer th:replace="fragmentos/footer :: footer"></footer>

</body>
</html>